'use strict';var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _jsxRuntime=require("react/jsx-runtime");var _jsxFileName="/Users/apratt/dev/tmp/react-native/IntegrationTests/TimersTest.js";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var React=require('react');var ReactNative=require('react-native');var StyleSheet=ReactNative.StyleSheet,Text=ReactNative.Text,View=ReactNative.View;var TestModule=ReactNative.NativeModules.TestModule;var TimersTest=function(_React$Component){(0,_inherits2.default)(TimersTest,_React$Component);var _super=_createSuper(TimersTest);function TimersTest(){var _this;(0,_classCallCheck2.default)(this,TimersTest);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this._nextTest=function(){};_this._interval=null;_this._timeoutIDs=new Set();_this._intervalIDs=new Set();_this._immediateIDs=new Set();_this._animationFrameIDs=new Set();_this.state={count:0,done:false};return _this;}(0,_createClass2.default)(TimersTest,[{key:"setTimeout",value:function(_setTimeout){function setTimeout(_x,_x2){return _setTimeout.apply(this,arguments);}setTimeout.toString=function(){return _setTimeout.toString();};return setTimeout;}(function(fn,time){var _this2=this;var id=setTimeout(function(){_this2._timeoutIDs.delete(id);fn();},time);this._timeoutIDs.add(id);return id;})},{key:"clearTimeout",value:function(_clearTimeout){function clearTimeout(_x3){return _clearTimeout.apply(this,arguments);}clearTimeout.toString=function(){return _clearTimeout.toString();};return clearTimeout;}(function(id){this._timeoutIDs.delete(id);clearTimeout(id);})},{key:"setInterval",value:function(_setInterval){function setInterval(_x4,_x5){return _setInterval.apply(this,arguments);}setInterval.toString=function(){return _setInterval.toString();};return setInterval;}(function(fn,time){var id=setInterval(function(){fn();},time);this._intervalIDs.add(id);return id;})},{key:"clearInterval",value:function(_clearInterval){function clearInterval(_x6){return _clearInterval.apply(this,arguments);}clearInterval.toString=function(){return _clearInterval.toString();};return clearInterval;}(function(id){this._intervalIDs.delete(id);clearInterval(id);})},{key:"setImmediate",value:function(_setImmediate){function setImmediate(_x7){return _setImmediate.apply(this,arguments);}setImmediate.toString=function(){return _setImmediate.toString();};return setImmediate;}(function(fn){var _this3=this;var id=setImmediate(function(){_this3._immediateIDs.delete(id);fn();});this._immediateIDs.add(id);return id;})},{key:"requestAnimationFrame",value:function(_requestAnimationFrame){function requestAnimationFrame(_x8){return _requestAnimationFrame.apply(this,arguments);}requestAnimationFrame.toString=function(){return _requestAnimationFrame.toString();};return requestAnimationFrame;}(function(fn){var _this4=this;var id=requestAnimationFrame(function(){_this4._animationFrameIDs.delete(id);fn();});this._animationFrameIDs.add(id);return id;})},{key:"cancelAnimationFrame",value:function(_cancelAnimationFrame){function cancelAnimationFrame(_x9){return _cancelAnimationFrame.apply(this,arguments);}cancelAnimationFrame.toString=function(){return _cancelAnimationFrame.toString();};return cancelAnimationFrame;}(function(id){this._animationFrameIDs.delete(id);cancelAnimationFrame(id);})},{key:"componentDidMount",value:function componentDidMount(){this.setTimeout(this.testSetTimeout0,1000);}},{key:"testSetTimeout0",value:function testSetTimeout0(){this.setTimeout(this.testSetTimeout1,0);}},{key:"testSetTimeout1",value:function testSetTimeout1(){this.setTimeout(this.testSetTimeout50,1);}},{key:"testSetTimeout50",value:function testSetTimeout50(){this.setTimeout(this.testRequestAnimationFrame,50);}},{key:"testRequestAnimationFrame",value:function testRequestAnimationFrame(){this.requestAnimationFrame(this.testSetInterval0);}},{key:"testSetInterval0",value:function testSetInterval0(){this._nextTest=this.testSetInterval20;this._interval=this.setInterval(this._incrementInterval,0);}},{key:"testSetInterval20",value:function testSetInterval20(){this._nextTest=this.testSetImmediate;this._interval=this.setInterval(this._incrementInterval,20);}},{key:"testSetImmediate",value:function testSetImmediate(){this.setImmediate(this.testClearTimeout0);}},{key:"testClearTimeout0",value:function testClearTimeout0(){var _this5=this;var timeout=this.setTimeout(function(){return _this5._fail('testClearTimeout0');},0);this.clearTimeout(timeout);this.testClearTimeout30();}},{key:"testClearTimeout30",value:function testClearTimeout30(){var _this6=this;var timeout=this.setTimeout(function(){return _this6._fail('testClearTimeout30');},30);this.clearTimeout(timeout);this.setTimeout(this.testClearMulti,50);}},{key:"testClearMulti",value:function testClearMulti(){var _this7=this;var fails=[];fails.push(this.setTimeout(function(){return _this7._fail('testClearMulti-1');},20));fails.push(this.setTimeout(function(){return _this7._fail('testClearMulti-2');},50));var delayClear=this.setTimeout(function(){return _this7._fail('testClearMulti-3');},50);fails.push(this.setTimeout(function(){return _this7._fail('testClearMulti-4');},0));fails.push(this.setTimeout(function(){return _this7._fail('testClearMulti-5');},10));fails.forEach(function(timeout){return _this7.clearTimeout(timeout);});this.setTimeout(function(){return _this7.clearTimeout(delayClear);},20);this.setTimeout(this.testOrdering,50);}},{key:"testOrdering",value:function testOrdering(){var _this8=this;var fail0;this.setImmediate(function(){return _this8.clearTimeout(fail0);});fail0=this.setTimeout(function(){return _this8._fail('testOrdering-t0, setImmediate should happen before '+'setTimeout 0');},0);var failAnim;this.setTimeout(function(){return _this8.cancelAnimationFrame(failAnim);},0);failAnim=this.requestAnimationFrame(function(){return _this8._fail('testOrdering-Anim, setTimeout 0 should happen before '+'requestAnimationFrame');});var fail25;this.setTimeout(function(){_this8.clearTimeout(fail25);},20);fail25=this.setTimeout(function(){return _this8._fail('testOrdering-t25, setTimeout 20 should happen before '+'setTimeout 25');},25);this.setTimeout(this.done,50);}},{key:"done",value:function done(){this.setState({done:true},function(){TestModule.markTestCompleted();});}},{key:"componentWillUnmount",value:function componentWillUnmount(){for(var timeoutID of this._timeoutIDs){clearTimeout(timeoutID);}for(var intervalID of this._intervalIDs){clearInterval(intervalID);}for(var requestAnimationFrameID of this._animationFrameIDs){cancelAnimationFrame(requestAnimationFrameID);}for(var immediateID of this._immediateIDs){clearImmediate(immediateID);}this._timeoutIDs=new Set();this._intervalIDs=new Set();this._animationFrameIDs=new Set();this._immediateIDs=new Set();if(this._interval!=null){clearInterval(this._interval);this._interval=null;}}},{key:"render",value:function render(){return(0,_jsxRuntime.jsx)(View,{style:styles.container,children:(0,_jsxRuntime.jsxs)(Text,{children:[this.constructor.name+': \n',"Intervals: ",this.state.count+'\n',this.state.done?'Done':'Testing...']})});}},{key:"_incrementInterval",value:function _incrementInterval(){if(this.state.count>3){throw new Error('interval incremented past end.');}if(this.state.count===3){if(this._interval!=null){this.clearInterval(this._interval);this._interval=null;}this.setState({count:0},this._nextTest);return;}this.setState({count:this.state.count+1});}},{key:"_fail",value:function _fail(caller){throw new Error('_fail called by '+caller);}}]);return TimersTest;}(React.Component);var styles=StyleSheet.create({container:{backgroundColor:'white',padding:40}});TimersTest.displayName='TimersTest';module.exports=TimersTest;