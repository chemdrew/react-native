'use strict';var _require=require('../parseLogBoxLog'),parseLogBoxException=_require.parseLogBoxException,parseLogBoxLog=_require.parseLogBoxLog;describe('parseLogBoxLog',function(){it('parses strings',function(){expect(parseLogBoxLog(['A'])).toEqual({componentStack:[],category:'A',message:{content:'A',substitutions:[]}});});it('parses strings with arguments',function(){expect(parseLogBoxLog(['A','B','C'])).toEqual({componentStack:[],category:'A B C',message:{content:'A B C',substitutions:[]}});});it('parses formatted strings',function(){expect(parseLogBoxLog(['%s','A'])).toEqual({componentStack:[],category:"\uFEFF%s",message:{content:'A',substitutions:[{length:1,offset:0}]}});});it('parses formatted strings with insufficient arguments',function(){expect(parseLogBoxLog(['%s %s','A'])).toEqual({componentStack:[],category:"\uFEFF%s %s",message:{content:'A %s',substitutions:[{length:1,offset:0},{length:2,offset:2}]}});});it('parses formatted strings with excess arguments',function(){expect(parseLogBoxLog(['%s','A','B'])).toEqual({componentStack:[],category:"\uFEFF%s B",message:{content:'A B',substitutions:[{length:1,offset:0}]}});});it('treats "%s" in arguments as literals',function(){expect(parseLogBoxLog(['%s','%s','A'])).toEqual({componentStack:[],category:"\uFEFF%s A",message:{content:'%s A',substitutions:[{length:2,offset:0}]}});});it('detects a component stack in an interpolated warning',function(){expect(parseLogBoxLog(['Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s%s','\n\nCheck the render method of `Container(Component)`.','\n    in MyComponent (at filename.js:1)\n    in MyOtherComponent (at filename2.js:1)'])).toEqual({componentStack:[{content:'MyComponent',fileName:'filename.js',location:{column:-1,row:1}},{content:'MyOtherComponent',fileName:'filename2.js',location:{column:-1,row:1}}],category:'Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?ï»¿%s',message:{content:'Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?\n\nCheck the render method of `Container(Component)`.',substitutions:[{length:52,offset:129}]}});});it('detects a component stack in the first argument',function(){expect(parseLogBoxLog(['Some kind of message\n    in MyComponent (at filename.js:1)\n    in MyOtherComponent (at filename2.js:1)'])).toEqual({componentStack:[{content:'MyComponent',fileName:'filename.js',location:{column:-1,row:1}},{content:'MyOtherComponent',fileName:'filename2.js',location:{column:-1,row:1}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});it('detects a component stack in the second argument',function(){expect(parseLogBoxLog(['Some kind of message','\n    in MyComponent (at filename.js:1)\n    in MyOtherComponent (at filename2.js:1)'])).toEqual({componentStack:[{content:'MyComponent',fileName:'filename.js',location:{column:-1,row:1}},{content:'MyOtherComponent',fileName:'filename2.js',location:{column:-1,row:1}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});it('detects a component stack in the nth argument',function(){expect(parseLogBoxLog(['Some kind of message','Some other kind of message','\n    in MyComponent (at filename.js:1)\n    in MyOtherComponent (at filename2.js:1)','Some third kind of message'])).toEqual({componentStack:[{content:'MyComponent',fileName:'filename.js',location:{column:-1,row:1}},{content:'MyOtherComponent',fileName:'filename2.js',location:{column:-1,row:1}}],category:'Some kind of message Some other kind of message Some third kind of message',message:{content:'Some kind of message Some other kind of message Some third kind of message',substitutions:[]}});});it('parses a transform error as a fatal',function(){var error={message:'TransformError failed to transform file.',originalMessage:'TransformError failed to transform file.',name:'',isComponentError:false,componentStack:'',stack:[],id:0,isFatal:true};expect(parseLogBoxException(error)).toEqual({level:'syntax',isComponentError:false,message:{content:'TransformError failed to transform file.',substitutions:[]},stack:[],componentStack:[],category:'TransformError failed to transform file.'});});it('parses a babel transform syntax error',function(){var error={message:"\n\n  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |",originalMessage:"TransformError SyntaxError: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: 'import' and 'export' may only appear at the top level (199:0)\n\n  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |",name:'',isComponentError:false,componentStack:'',stack:[],id:0,isFatal:true};expect(parseLogBoxException(error)).toEqual({level:'syntax',isComponentError:false,codeFrame:{fileName:'/path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js',location:{row:199,column:0},content:"  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |"},message:{content:"'import' and 'export' may only appear at the top level",substitutions:[]},stack:[],componentStack:[],category:'/path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js-199-0'});});it('parses an invalid require syntax error',function(){var error={message:"Unable to resolve module `ListCellx` from /path/to/file.js: ListCellx could not be found within the project.\n\nIf you are sure the module exists, try these steps:\n 1. Clear watchman watches: watchman watch-del-all\n 2. Delete node_modules and run yarn install\n 3. Reset Metro's cache: yarn start --reset-cache\n 4. Remove the cache: rm -rf /tmp/metro-*\n\x1B[0m \x1B[90m 10 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mColor\x1B[39m from \x1B[32m'Color'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 11 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mList\x1B[39m from \x1B[32m'List'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m\x1B[31m\x1B[1m>\x1B[22m\x1B[39m\x1B[90m 12 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mListCell\x1B[39m from \x1B[32m'ListCellx'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m    | \x1B[39m                           \x1B[31m\x1B[1m^\x1B[22m\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 13 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mNullState\x1B[39m from \x1B[32m'NullState'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 14 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mUnitHeader\x1B[39m from \x1B[32m'UnitHeader'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 15 | \x1B[39m\x1B[36mimport\x1B[39m fbRemoteAsset from \x1B[32m'fbRemoteAsset'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m",originalMessage:"Unable to resolve module `ListCellx` from /path/to/file.js: ListCellx could not be found within the project.\n\nIf you are sure the module exists, try these steps:\n 1. Clear watchman watches: watchman watch-del-all\n 2. Delete node_modules and run yarn install\n 3. Reset Metro's cache: yarn start --reset-cache\n 4. Remove the cache: rm -rf /tmp/metro-*\n\x1B[0m \x1B[90m 10 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mColor\x1B[39m from \x1B[32m'Color'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 11 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mList\x1B[39m from \x1B[32m'List'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m\x1B[31m\x1B[1m>\x1B[22m\x1B[39m\x1B[90m 12 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mListCell\x1B[39m from \x1B[32m'ListCellx'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m    | \x1B[39m                           \x1B[31m\x1B[1m^\x1B[22m\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 13 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mNullState\x1B[39m from \x1B[32m'NullState'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 14 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mUnitHeader\x1B[39m from \x1B[32m'UnitHeader'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 15 | \x1B[39m\x1B[36mimport\x1B[39m fbRemoteAsset from \x1B[32m'fbRemoteAsset'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m",name:'',isComponentError:false,componentStack:'',stack:[],id:0,isFatal:true};expect(parseLogBoxException(error)).toEqual({level:'syntax',isComponentError:false,codeFrame:{fileName:'/path/to/file.js',location:null,content:"\x1B[0m \x1B[90m 10 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mColor\x1B[39m from \x1B[32m'Color'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 11 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mList\x1B[39m from \x1B[32m'List'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m\x1B[31m\x1B[1m>\x1B[22m\x1B[39m\x1B[90m 12 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mListCell\x1B[39m from \x1B[32m'ListCellx'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m    | \x1B[39m                           \x1B[31m\x1B[1m^\x1B[22m\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 13 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mNullState\x1B[39m from \x1B[32m'NullState'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 14 | \x1B[39m\x1B[36mimport\x1B[39m \x1B[33mUnitHeader\x1B[39m from \x1B[32m'UnitHeader'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 15 | \x1B[39m\x1B[36mimport\x1B[39m fbRemoteAsset from \x1B[32m'fbRemoteAsset'\x1B[39m\x1B[33m;\x1B[39m\x1B[0m"},message:{content:"ListCellx could not be found within the project.\n\nIf you are sure the module exists, try these steps:\n 1. Clear watchman watches: watchman watch-del-all\n 2. Delete node_modules and run yarn install\n 3. Reset Metro's cache: yarn start --reset-cache\n 4. Remove the cache: rm -rf /tmp/metro-*",substitutions:[]},stack:[],componentStack:[],category:'/path/to/file.js-1-1'});});it('parses a reference error',function(){var error={message:"\n\n  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |",originalMessage:"TransformError ReferenceError: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: 'import' and 'export' may only appear at the top level (199:0)\n\n  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |",name:'',isComponentError:false,componentStack:'',stack:[],id:0,isFatal:true};expect(parseLogBoxException(error)).toEqual({level:'syntax',isComponentError:false,codeFrame:{fileName:'/path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js',location:{row:199,column:0},content:"  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |"},message:{content:"'import' and 'export' may only appear at the top level",substitutions:[]},stack:[],componentStack:[],category:'/path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js-199-0'});});it('parses a babel codeframe error',function(){var error={message:"TransformError RKJSModules/Apps/CrashReact/CrashReactApp.js: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: The first argument to `fbRemoteAsset` is \"null_state_glyphs\", but the requested asset is missing from the local metadata. Either the asset does not exist or the metadata is not up-to-date.\n\nPlease follow the instructions at: fburl.com/rn-remote-assets\n  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |",originalMessage:"TransformError RKJSModules/Apps/CrashReact/CrashReactApp.js: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: The first argument to `fbRemoteAsset` is \"null_state_glyphs\", but the requested asset is missing from the local metadata. Either the asset does not exist or the metadata is not up-to-date.\n\nPlease follow the instructions at: fburl.com/rn-remote-assets\n  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |",name:'',isComponentError:false,componentStack:'',stack:[],id:0,isFatal:true};expect(parseLogBoxException(error)).toEqual({level:'syntax',isComponentError:false,codeFrame:{fileName:'/path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js',location:null,content:"  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |"},message:{content:"The first argument to `fbRemoteAsset` is \"null_state_glyphs\", but the requested asset is missing from the local metadata. Either the asset does not exist or the metadata is not up-to-date.\n\nPlease follow the instructions at: fburl.com/rn-remote-assets",substitutions:[]},stack:[],componentStack:[],category:'/path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js-1-1'});});it('parses a babel codeframe error with ansi',function(){var error={message:"TransformError RKJSModules/Apps/CrashReact/CrashReactApp.js: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: The first argument to `fbRemoteAsset` is \"null_state_glyphs\", but the requested asset is missing from the local metadata. Either the asset does not exist or the metadata is not up-to-date.\n\nPlease follow the instructions at: fburl.com/rn-remote-assets\n  197 | });\n  198 |\n> 199 | export default CrashReactApp;\n      | ^\n  200 |",originalMessage:"TransformError RKJSModules/Apps/CrashReact/CrashReactApp.js: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: The first argument to `fbRemoteAsset` is \"null_state_glyphs\", but the requested asset is missing from the local metadata. Either the asset does not exist or the metadata is not up-to-date.\n\nPlease follow the instructions at: fburl.com/rn-remote-assets\n\x1B[0m \x1B[90m 46 | \x1B[39m            headline\x1B[33m=\x1B[39m\x1B[32m\"CrashReact Error Boundary\"\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 47 | \x1B[39m            body\x1B[33m=\x1B[39m{\x1B[32m`${this.state.errorMessage}`\x1B[39m}\x1B[0m\n\x1B[0m\x1B[31m\x1B[1m>\x1B[22m\x1B[39m\x1B[90m 48 | \x1B[39m            icon\x1B[33m=\x1B[39m{fbRemoteAsset(\x1B[32m'null_state_glyphs'\x1B[39m\x1B[33m,\x1B[39m {\x1B[0m\n\x1B[0m \x1B[90m    | \x1B[39m                                                     \x1B[31m\x1B[1m^\x1B[22m\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 49 | \x1B[39m              name\x1B[33m:\x1B[39m \x1B[32m'codexxx'\x1B[39m\x1B[33m,\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 50 | \x1B[39m              size\x1B[33m:\x1B[39m \x1B[32m'112'\x1B[39m\x1B[33m,\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 51 | \x1B[39m            })}\x1B[0m",name:'',isComponentError:false,componentStack:'',stack:[],id:0,isFatal:true};expect(parseLogBoxException(error)).toEqual({level:'syntax',isComponentError:false,codeFrame:{fileName:'/path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js',location:null,content:"\x1B[0m \x1B[90m 46 | \x1B[39m            headline\x1B[33m=\x1B[39m\x1B[32m\"CrashReact Error Boundary\"\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 47 | \x1B[39m            body\x1B[33m=\x1B[39m{\x1B[32m`${this.state.errorMessage}`\x1B[39m}\x1B[0m\n\x1B[0m\x1B[31m\x1B[1m>\x1B[22m\x1B[39m\x1B[90m 48 | \x1B[39m            icon\x1B[33m=\x1B[39m{fbRemoteAsset(\x1B[32m'null_state_glyphs'\x1B[39m\x1B[33m,\x1B[39m {\x1B[0m\n\x1B[0m \x1B[90m    | \x1B[39m                                                     \x1B[31m\x1B[1m^\x1B[22m\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 49 | \x1B[39m              name\x1B[33m:\x1B[39m \x1B[32m'codexxx'\x1B[39m\x1B[33m,\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 50 | \x1B[39m              size\x1B[33m:\x1B[39m \x1B[32m'112'\x1B[39m\x1B[33m,\x1B[39m\x1B[0m\n\x1B[0m \x1B[90m 51 | \x1B[39m            })}\x1B[0m"},message:{content:"The first argument to `fbRemoteAsset` is \"null_state_glyphs\", but the requested asset is missing from the local metadata. Either the asset does not exist or the metadata is not up-to-date.\n\nPlease follow the instructions at: fburl.com/rn-remote-assets",substitutions:[]},stack:[],componentStack:[],category:'/path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js-1-1'});});it('parses an error log with `error.componentStack`',function(){var error={id:0,isFatal:false,isComponentError:false,message:'### Error',originalMessage:'### Error',name:'',componentStack:'\n    in MyComponent (at filename.js:1)\n    in MyOtherComponent (at filename2.js:1)',stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]};expect(parseLogBoxException(error)).toEqual({level:'error',category:'### Error',isComponentError:false,message:{content:'### Error',substitutions:[]},componentStack:[{content:'MyComponent',fileName:'filename.js',location:{column:-1,row:1}},{content:'MyOtherComponent',fileName:'filename2.js',location:{column:-1,row:1}}],stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]});});it('parses an error log with a component stack in the message',function(){var error={id:0,isFatal:false,isComponentError:false,message:'Some kind of message\n    in MyComponent (at filename.js:1)\n    in MyOtherComponent (at filename2.js:1)',originalMessage:'Some kind of message\n    in MyComponent (at filename.js:1)\n    in MyOtherComponent (at filename2.js:1)',name:'',componentStack:null,stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]};expect(parseLogBoxException(error)).toEqual({level:'error',isComponentError:false,stack:[{collapse:false,column:1,file:'foo.js',lineNumber:1,methodName:'bar'}],componentStack:[{content:'MyComponent',fileName:'filename.js',location:{column:-1,row:1}},{content:'MyOtherComponent',fileName:'filename2.js',location:{column:-1,row:1}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});it('parses a fatal exception',function(){var error={id:0,isFatal:true,isComponentError:false,message:'### Fatal',originalMessage:'### Fatal',componentStack:null,name:'',stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]};expect(parseLogBoxException(error)).toEqual({level:'fatal',category:'### Fatal',isComponentError:false,message:{content:'### Fatal',substitutions:[]},componentStack:[],stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]});});it('parses a render error',function(){var error={id:0,isComponentError:true,isFatal:true,message:'### Fatal',originalMessage:'### Fatal',componentStack:null,name:'',stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]};expect(parseLogBoxException(error)).toEqual({level:'fatal',category:'### Fatal',isComponentError:true,message:{content:'### Fatal',substitutions:[]},componentStack:[],stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]});});it('a malformed syntax error falls back to a syntax error',function(){var error={id:0,isFatal:true,isComponentError:false,message:"TransformError SyntaxError: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: 'import' and 'export' may only appear at the top level (199:0)",originalMessage:"TransformError SyntaxError: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: 'import' and 'export' may only appear at the top level (199:0)",componentStack:null,name:'',stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]};expect(parseLogBoxException(error)).toEqual({level:'syntax',category:"TransformError SyntaxError: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: 'import' and 'export' may only appear at the top level (199:0)",message:{content:"TransformError SyntaxError: /path/to/RKJSModules/Apps/CrashReact/CrashReactApp.js: 'import' and 'export' may only appear at the top level (199:0)",substitutions:[]},isComponentError:false,componentStack:[],stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]});});describe('Handles component stack frames formatted as call stacks',function(){it('detects a component stack in an interpolated warning',function(){expect(parseLogBoxLog(['Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s%s','\n\nCheck the render method of `MyComponent`.','\n    at MyComponent (/path/to/filename.js:1:2)\n    at MyOtherComponent\n     at MyAppComponent (/path/to/app.js:100:20)'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?ï»¿%s',message:{content:'Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?\n\nCheck the render method of `MyComponent`.',substitutions:[{length:43,offset:129}]}});});it('detects a component stack in the first argument',function(){expect(parseLogBoxLog(['Some kind of message\n    at MyComponent (/path/to/filename.js:1:2)\n    at MyOtherComponent\n     at MyAppComponent (/path/to/app.js:100:20)'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});it('detects a component stack in the second argument',function(){expect(parseLogBoxLog(['Some kind of message','\n    at MyComponent (/path/to/filename.js:1:2)\n    at MyOtherComponent\n     at MyAppComponent (/path/to/app.js:100:20)'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});it('detects a component stack in the nth argument',function(){expect(parseLogBoxLog(['Warning: Each child in a list should have a unique "key" prop.%s%s See https://fb.me/react-warning-keys for more information.%s','\n\nCheck the render method of `MyOtherComponent`.','','\n    at MyComponent (/path/to/filename.js:1:2)\n    at MyOtherComponent\n     at MyAppComponent (/path/to/app.js:100:20)'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Warning: Each child in a list should have a unique "key" prop.ï»¿%sï»¿%s See https://fb.me/react-warning-keys for more information.',message:{content:'Warning: Each child in a list should have a unique "key" prop.\n\nCheck the render method of `MyOtherComponent`. See https://fb.me/react-warning-keys for more information.',substitutions:[{length:48,offset:62},{length:0,offset:110}]}});});it('parses an error log with `error.componentStack`',function(){var error={id:0,isFatal:false,isComponentError:false,message:'### Error',originalMessage:'### Error',name:'',componentStack:'\n    at MyComponent (/path/to/filename.js:1:2)\n    at MyOtherComponent\n     at MyAppComponent (/path/to/app.js:100:20)',stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]};expect(parseLogBoxException(error)).toEqual({level:'error',category:'### Error',isComponentError:false,message:{content:'### Error',substitutions:[]},componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]});});});describe('Handles component stack frames formatted as call stacks in JSC',function(){it('detects a component stack in an interpolated warning',function(){expect(parseLogBoxLog(['Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s%s','\n\nCheck the render method of `MyComponent`.','\nMyComponent@/path/to/filename.js:1:2\nforEach@[native code]\nMyAppComponent@/path/to/app.js:100:20'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?ï»¿%s',message:{content:'Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?\n\nCheck the render method of `MyComponent`.',substitutions:[{length:43,offset:129}]}});});it('detects a component stack in the first argument',function(){expect(parseLogBoxLog(['Some kind of message\nMyComponent@/path/to/filename.js:1:2\nforEach@[native code]\nMyAppComponent@/path/to/app.js:100:20'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});it('detects a component stack in the first argument (JSC)',function(){expect(parseLogBoxLog(['Some kind of message\nMyComponent@/path/to/filename.js:1:2\nforEach@[native code]\nMyAppComponent@/path/to/app.js:100:20'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});it('detects a component stack in the second argument',function(){expect(parseLogBoxLog(['Some kind of message','\nMyComponent@/path/to/filename.js:1:2\nforEach@[native code]\nMyAppComponent@/path/to/app.js:100:20'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});it('detects a component stack in the nth argument',function(){expect(parseLogBoxLog(['Warning: Each child in a list should have a unique "key" prop.%s%s See https://fb.me/react-warning-keys for more information.%s','\n\nCheck the render method of `MyOtherComponent`.','','\nMyComponent@/path/to/filename.js:1:2\nforEach@[native code]\nMyAppComponent@/path/to/app.js:100:20'])).toEqual({componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Warning: Each child in a list should have a unique "key" prop.ï»¿%sï»¿%s See https://fb.me/react-warning-keys for more information.',message:{content:'Warning: Each child in a list should have a unique "key" prop.\n\nCheck the render method of `MyOtherComponent`. See https://fb.me/react-warning-keys for more information.',substitutions:[{length:48,offset:62},{length:0,offset:110}]}});});it('parses an error log with `error.componentStack`',function(){var error={id:0,isFatal:false,isComponentError:false,message:'### Error',originalMessage:'### Error',name:'',componentStack:'\nMyComponent@/path/to/filename.js:1:2\nforEach@[native code]\nMyAppComponent@/path/to/app.js:100:20',stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]};expect(parseLogBoxException(error)).toEqual({level:'error',category:'### Error',isComponentError:false,message:{content:'### Error',substitutions:[]},componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]});});it('parses an error log with a component stack in the message',function(){var error={id:0,isFatal:false,isComponentError:false,message:'Some kind of message\nMyComponent@/path/to/filename.js:1:2\nforEach@[native code]\nMyAppComponent@/path/to/app.js:100:20',originalMessage:'Some kind of message\nMyComponent@/path/to/filename.js:1:2\nforEach@[native code]\nMyAppComponent@/path/to/app.js:100:20',name:'',componentStack:null,stack:[{column:1,file:'foo.js',lineNumber:1,methodName:'bar',collapse:false}]};expect(parseLogBoxException(error)).toEqual({level:'error',isComponentError:false,stack:[{collapse:false,column:1,file:'foo.js',lineNumber:1,methodName:'bar'}],componentStack:[{collapse:false,content:'MyComponent',fileName:'/path/to/filename.js',location:{column:1,row:1}},{collapse:false,content:'MyAppComponent',fileName:'/path/to/app.js',location:{column:19,row:100}}],category:'Some kind of message',message:{content:'Some kind of message',substitutions:[]}});});});});