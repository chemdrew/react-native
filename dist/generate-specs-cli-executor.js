'use strict';var fs=require('fs');var mkdirp=require('mkdirp');var path=require('path');var utils=require('./codegen-utils');var RNCodegen=utils.getCodegen();var GENERATORS={all:{android:['componentsAndroid','modulesAndroid','modulesCxx'],ios:['componentsIOS','modulesIOS','modulesCxx']},components:{android:['componentsAndroid'],ios:['componentsIOS']},modules:{android:['modulesAndroid','modulesCxx'],ios:['modulesIOS','modulesCxx']}};function createOutputDirectoryIfNeeded(outputDirectory,libraryName){if(!outputDirectory){outputDirectory=path.resolve(__dirname,'..','Libraries',libraryName);}mkdirp.sync(outputDirectory);}function createFolderIfDefined(folder){if(folder){mkdirp.sync(folder);}}function readAndParseSchema(schemaPath){var schemaText=fs.readFileSync(schemaPath,'utf-8');if(schemaText==null){throw new Error("Can't find schema at "+schemaPath);}try{return JSON.parse(schemaText);}catch(err){throw new Error("Can't parse schema to JSON. "+schemaPath);}}function validateLibraryType(libraryType){if(GENERATORS[libraryType]==null){throw new Error("Invalid library type. "+libraryType);}}function generateSpec(platform,schemaPath,outputDirectory,libraryName,packageName,libraryType){validateLibraryType(libraryType);var schema=readAndParseSchema(schemaPath);createOutputDirectoryIfNeeded(outputDirectory,libraryName);function composePath(intermediate){return path.join(outputDirectory,intermediate,libraryName);}createFolderIfDefined(composePath('react/renderer/components/'));createFolderIfDefined(composePath('./'));RNCodegen.generate({libraryName:libraryName,schema:schema,outputDirectory:outputDirectory,packageName:packageName},{generators:GENERATORS[libraryType][platform]});if(platform==='android'){var files=fs.readdirSync(outputDirectory);var jniOutputDirectory=outputDirectory+"/jni/react/renderer/components/"+libraryName;mkdirp.sync(jniOutputDirectory);files.filter(function(f){return f.endsWith('.h')||f.endsWith('.cpp');}).forEach(function(f){fs.renameSync(outputDirectory+"/"+f,jniOutputDirectory+"/"+f);});}}module.exports={execute:generateSpec};